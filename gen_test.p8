pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--ideas
-- enemies cant jump, which 
--		makes hiding in high places
-- 	nice.
-- player must collect flowers
--		and return to home base to
--  do something with them?
--			weapons,etc...


hb={cx=4,cy=4,w=8,h=8}
c_x=0
c_y=0
p_x=0
p_y=0

lvl={}
found={}
printh("=========")
function rand(bot,top)
	return flr(rnd(abs(top)+abs(bot)+1))+bot
end

function _init()
	-- create array
	for j=1,8 do
		local r={}
		for i=1,8 do add(r,0) end
		add(lvl,r)
	end
	
	create_lvl()
	
	-- draw level
	//for j=1,8 do
	//	for i=1,8 do
	//		if(lvl[j][i]==1)mset(i-1,j-1,0)
	//		if(lvl[j][i]==0)mset(i-1,j-1,1)
	//	end
	//end
end

function _draw()
	cls()
	camera(p_x,p_y)
	m_x=flr(p_x/8)-1
	m_y=flr(p_y/8)-1
	//map(m_x,m_y,m_x*8,m_y*8,18,18)
	//spr(3,p_x,p_y)
	//spr(4,p_x+4,p_y+7)
	for j=1,8 do
		for i=1,8 do
			print(lvl[j][i],i*5,j*6)
		end
	end
end

function _update()
	dx,dy=0,0
	if(btn(0))dx=-1
	if(btn(1))dx=1
	if(btn(2))dy=-1
	if(btn(3))dy=1
	//local o=mget((p_x+4)/8,(p_y+4)/8)
	//if(fget(o,0)and dx==1)then
	//	dx=0
	//end
	p_x+=dx
end

function create_lvl()
	-- run lazy algo
	local ci,cj,total,chs=2,2,0,true
	local ii,jj=0,0
	while total<32 do
		if chs then
			local imin,imax,jmin,jmax=0,0,0,0
			if(ci>2 and lvl[cj][ci-1]==0 and lvl[cj][ci-2]==0)imin=-1
			if(ci<7 and lvl[cj][ci+1]==0 and lvl[cj][ci+2]==0)imax=1	
			if(cj>2 and lvl[cj-1][ci]==0 and lvl[cj-2][ci]==0)jmin=-1
			if(cj<7 and lvl[cj+1][ci]==0 and lvl[cj+2][ci]==0)jmax=1
		
			ii=rand(imin,imax)
			jj=rand(jmin,jmax)
		
			if imin==0 and imax==0 and jmin==0 and jmax==0 then
				--find new place
				printh("finding new")
				local nn=0
				for k in all(found) do
					nn+=1
				end
				local n=flr(rnd(nn))+1
				cj=found[n][1]
				ci=found[n][2]
			elseif abs(ii)!=abs(jj) then
				ci+=ii
				cj+=jj
				if(abs(ii)==1)lvl[cj][ci]=2
				if(abs(jj)==1)lvl[cj][ci]=3
				add(found,{cj,ci})
				total+=1
				chs=false
			end
		else
			chs=true
			ci+=ii
			cj+=jj
			if(abs(ii)==1)lvl[cj][ci]=2
			if(abs(jj)==1)lvl[cj][ci]=3
			add(found,{cj,ci})
			total+=1
		end
		//local s=ci.." "..cj.." "
		//s=s..imin.." "..imax.." "
		//s=s..jmin.." "..jmax.." "
		//printh(s)
	end
end
__gfx__
000000000bb31bb344521242445212420d400d400000000000000000000000000000000000000000000000000000000000000000000000000000000000000010
00000000bb30b30b4040440540064405666666650000000000000000000000000000000000000000000000000000000000000000000000000000000000100000
00700700b1bb0bb34144055440055554655555550000000000eeeee0000000000000000000000000000000000000000000000000000000000000000000100010
0007700045054b0445054404400065040dd00dd00000000000ee7e70000000000000000000000000000000000000000000000000000000000000000001000100
000770005444024454040244540056440d400d400030000000eeeee0000000000000000000000000000000000000000000000000000000000000000000000000
00700700420454204202542042000550666666650300000000999900000000000000000000000000000000000000000000000000000000000000000001000100
000000005440450454444504544000546555555503000300009799f0000000000000000000000000000000000000000000000000000000000000000000100000
000000002500404025004040250000000dd00dd00030033000999900000000000000000000000000000000000000000000000000000000000000000000000010
0bb31bb300b31bb34452124200000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb30b30b0b30b30b4040440500000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
b1bb0bb3b1bb0bb34144055400000000000b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4503bb03b3354b044515440100000000030300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
5453b243b30402441101021400000000003030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
4200b420430054201200512000000000000030300900000000000000000000000000000000000000000000000000000000000000000000000000000000000000
54404504544045044110110100000000000b03009090080000000000000000000000000000000000000000000000000000000000000000000000000000000000
25004040250440402100101000000000000300000900888000000000000000000000000000000000000000000000000000000000000000000000000000000000
0bb31bb30bb31b001152121200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
bb31b30bbb30b3301010111500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31bb0bb3b1bb0bb31111055100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
33011b3345054bbb1505110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
331102335404024b1101021100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
131001234200542b1200512000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01001503544045041110110100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
20001010250040402100101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0909090101020302021212020222222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
09012102202010010222220f2200052202000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0102020f0f0f0200050005150f00112201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202090f0f0f1120202020202104002200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02090905090f01140014140f0204000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02010011012114140114140f0204110200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02050000200120202114010f0204000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01012100000f0f05001411012104001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02100211210f1121020121020f04110200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1210121200060f002020120f0f11120300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0f120f0f0f010f0f0f14000f1102222200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1515000011020f01001021150f04220000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01012100040f0f11011010012104000500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1212121104210f00022021020f04111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
