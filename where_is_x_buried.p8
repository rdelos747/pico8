pico-8 cartridge // http://www.pico-8.com
version 32
__lua__
px,py=64,64

function _init()
	init_lvl(0,0)
end

function _draw()
	cls()
	for o in all(lvl) do
		spr(o.s,o.x,o.y)
	end
	
	spr(33,px-4,py-4)
	
	for s in all(shdw) do
		for y=0,7 do
		for x=0,7 do
			sc=sget(
				(s.s*8)%128+x,
				flr(s.s/16)*8+y
			)
			if sc!=0 then
				apply_shadow(s.x+x,s.y+y)
			end
			--[[
			if(sc==0)goto continue
			wx,wy=s.x+x,s.y+y
			if pget(wx ,wy)==11 then
				pset(wx,wy,3)
			end
			
			::continue::
			]]--
		end end
	end
end

function _update()
	if(btn(⬅️))px-=1
	if(btn(➡️))px+=1
	if(btn(⬆️))py-=1
	if(btn(⬇️))py+=1
end
-->8
function init_lvl(wi,wj)
	local si,sj=wi+128,wj+128
	
	printh("creating room "..
		wi..","..wj.." ("..
		si..","..sj..")")
	srand((sj<<8)+si)
	
	lvl={}
	for j=0,15 do
	for i=0,15 do
		add(lvl,{s=1,x=i*8,y=j*8})
	end end
	
	shdw={}
	for i=0,100 do
		add(shdw,{
			s=60,
			x=rand(0,15)*8,
			y=rand(0,15)*8
		})
	end
end
-->8
function rand(l,h)
	return flr(rnd(h+1-l))+l
end


swaps={
	0,//0
	0,//1
	0,//2
	1,//3
	0,//4
	0,//5
	0,//6
	6,//7
	0,//8
	0,//9
	0,//10
	3,//11
	13,//12
	0,//13
	0,//14
	0,//15
}

function apply_shadow(wx,wy)
	local c=pget(wx,wy)
	pset(wx,wy,swaps[c+1])
end
__gfx__
00000000bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbb3b3b0007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700bbbbbb3b0007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000bbbbbbbb0777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000bbbbbbbb0777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700b3bbbbbb0007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000b3bbbbbb0007700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000bbbbbbbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000078878000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000888888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000887888800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000088887000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007c7c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007007000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000777000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077770000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007777770000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007777770000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007777000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077077070000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000770000000000000000000000000
__map__
0101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101110101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101011101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0101010101010101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
